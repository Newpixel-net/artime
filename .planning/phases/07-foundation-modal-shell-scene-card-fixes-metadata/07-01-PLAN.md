---
phase: 07-foundation-modal-shell-scene-card-fixes-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/resources/views/livewire/steps/storyboard.blade.php
autonomous: true

must_haves:
  truths:
    - Scene card shows accurate segment type label based on segments present (not hardcoded Dialogue)
    - Scene card shows type-specific icons matching segment types
    - Scene card indicates click to view all when more than 2 segments
  artifacts:
    - path: modules/AppVideoWizard/resources/views/livewire/steps/storyboard.blade.php
      provides: Dynamic speech label and icons based on segment composition
      min_lines: 2500
      contains: "speechLabel based on segment type analysis"
  key_links:
    - from: storyboard.blade.php
      to: "$speechSegments array"
      via: "Blade PHP logic analyzing segment type distribution"
      pattern: "collect.*speechSegments.*filter.*type"
---

<objective>
Fix scene card speech label to show accurate segment type summary instead of hardcoded Dialogue.

Purpose: Users currently see incorrect Dialogue label on all scenes even when content is Narration or Internal Monologue. This creates confusion and distrust in the system.

Output: Scene cards with correct dynamic labels (Dialogue/Narration/Internal/Monologue/Mixed) and matching icons based on segment composition.
</objective>

<execution_context>
@C:\Users\VoltaPsy\AppData\Roaming\Claude\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\VoltaPsy\AppData\Roaming\Claude\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\PROJECT.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\ROADMAP.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\STATE.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\REQUIREMENTS.md

Existing implementation (lines 2497-2569) has partial dynamic logic but needs refinement:
- Line 2510 uses priority order (dialogue > monologue > internal > narrator)
- Missing: Mixed type detection when multiple types present
- Missing: Clear visual indication that label represents FIRST type only
</context>

<tasks>

<task type="auto">
  <name>Enhance scene card speech label logic for accurate type representation</name>
  <files>modules/AppVideoWizard/resources/views/livewire/steps/storyboard.blade.php</files>
  <action>
    Update the speech label logic (lines 2497-2569) to:

    1. Count segment types (not just boolean presence):
       ```php
       $typeCounts = collect($speechSegments)->groupBy('type')->map->count();
       $totalSegments = count($speechSegments);
       $hasMultipleTypes = $typeCounts->count() > 1;
       ```

    2. Determine label strategy:
       - If single type dominates (>80%): Use that type name (DIALOGUE/NARRATION/INTERNAL/MONOLOGUE)
       - If multiple types present: Use "Mixed" with count badge
       - Current priority order is WRONG - should show dominant type, not first found

    3. Icon strategy:
       - Single type: Show that type's icon
       - Mixed: Show stacked icon representation (üí¨/üéôÔ∏è) or generic üìù

    4. Update speech label display (line 2534) to show:
       - Type name in UPPERCASE for clarity
       - Segment count badge: (3) ‚Üí (3 segments)
       - Mixed indicator when applicable: "MIXED (5 segments: 3 dialogue, 2 narration)"

    5. Update segment preview section (lines 2549-2569):
       - Ensure first 2 segments shown represent type diversity (not just first 2)
       - If mixed types, show 1 of each type preferably

    6. Add "click to view all" text to Inspect button tooltip (line 2542)

    DO NOT change line 2540 (openSceneTextInspector call) - that's handled in Plan 02.

    Why this approach: Priority order creates false labels (shows Dialogue when scene is 90% narration with 1 dialogue line). Dominant type + Mixed category provides accurate representation.
  </action>
  <verify>
    1. Read the updated storyboard.blade.php file and confirm logic changes
    2. Check that type counting uses groupBy()->map->count() pattern
    3. Verify Mixed label logic for multiple types
    4. Confirm segment preview shows type diversity
  </verify>
  <done>
    Scene card speech label logic accurately represents segment type distribution with dominant type detection, Mixed category for multi-type scenes, and enhanced tooltips indicating full content available in inspector.
  </done>
</task>

<task type="auto">
  <name>Add comprehensive type indicator icons to segment previews</name>
  <files>modules/AppVideoWizard/resources/views/livewire/steps/storyboard.blade.php</files>
  <action>
    Enhance segment preview display (lines 2549-2569) with clearer type indicators:

    1. Update type icon mapping (lines 2514-2519) with accessibility labels:
       ```php
       $typeIcons = [
           'narrator' => ['icon' => 'üéôÔ∏è', 'color' => 'rgba(14, 165, 233, 0.4)', 'label' => 'NARRATOR'],
           'dialogue' => ['icon' => 'üí¨', 'color' => 'rgba(34, 197, 94, 0.4)', 'label' => 'DIALOGUE'],
           'internal' => ['icon' => 'üí≠', 'color' => 'rgba(168, 85, 247, 0.4)', 'label' => 'INTERNAL'],
           'monologue' => ['icon' => 'üó£Ô∏è', 'color' => 'rgba(251, 191, 36, 0.4)', 'label' => 'MONOLOGUE'],
       ];
       ```

    2. Update segment rendering (lines 2552-2563):
       - Use semantic structure: icon + type label + speaker name (if applicable)
       - Make type label UPPERCASE for scanability
       - Add lip-sync indicator badge for dialogue/monologue: "üëÑ LIP-SYNC" in small text

    3. Add truncation indicator (line 2566-2568):
       - Current: "+X more segments... click to view all"
       - Enhanced: "+X more (Y dialogue, Z narration) - click Inspect to view all"

    Why structured icons: Users need to quickly scan segment types. Current implementation has icons but labels are lowercase and hard to scan. UPPERCASE + consistent positioning improves scanability.
  </action>
  <verify>
    1. Read updated storyboard.blade.php segment preview section
    2. Confirm type icons use semantic array structure with color/label
    3. Verify UPPERCASE type labels
    4. Check truncation indicator shows type breakdown
  </verify>
  <done>
    Segment previews display comprehensive type indicators with UPPERCASE labels, semantic color coding, speaker attribution, and truncation indicators showing type distribution for hidden segments.
  </done>
</task>

</tasks>

<verification>
Manual verification after execution:
1. Open Video Wizard storyboard view
2. Check scene cards with:
   - All narration segments ‚Üí should show "NARRATION" label
   - All dialogue segments ‚Üí should show "DIALOGUE" label
   - Mixed types ‚Üí should show "MIXED" with count breakdown
3. Verify icons match type (üéôÔ∏è for narration, üí¨ for dialogue, etc.)
4. Confirm truncation text shows type breakdown
5. Check that first 2 segment previews show type diversity when mixed
</verification>

<success_criteria>
- Scene cards show accurate speech type labels based on segment composition
- Priority order replaced with dominant type detection (>80% threshold)
- Mixed category shown when multiple types present with count breakdown
- Type-specific icons displayed consistently with UPPERCASE labels
- Truncation indicator shows what types are hidden
- Inspect button tooltip clarifies that full content is viewable
</success_criteria>

<output>
After completion, create `.planning/phases/07-foundation-modal-shell-scene-card-fixes-metadata/07-01-SUMMARY.md`
</output>
