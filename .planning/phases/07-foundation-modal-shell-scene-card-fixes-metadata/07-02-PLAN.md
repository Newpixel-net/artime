---
phase: 07-foundation-modal-shell-scene-card-fixes-metadata
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
  - modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
  - modules/AppVideoWizard/resources/views/livewire/video-wizard.blade.php
autonomous: true

must_haves:
  truths:
    - User can click Inspect button on scene card and modal opens immediately
    - Modal displays correct scene number and title
    - Modal has close button (X) that works
    - ESC key closes modal
    - Modal content is scrollable without body scroll
  artifacts:
    - path: modules/AppVideoWizard/app/Livewire/VideoWizard.php
      provides: Inspector modal state management
      exports: ["openSceneTextInspector", "closeSceneTextInspector"]
      contains: "$showSceneTextInspectorModal"
    - path: modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
      provides: Inspector modal UI structure
      min_lines: 100
      contains: "vw-modal-overlay"
    - path: modules/AppVideoWizard/resources/views/livewire/video-wizard.blade.php
      provides: Modal inclusion in main layout
      contains: "@include.*scene-text-inspector"
  key_links:
    - from: storyboard.blade.php Inspect button
      to: "VideoWizard::openSceneTextInspector()"
      via: "wire:click event"
      pattern: "wire:click.*openSceneTextInspector"
    - from: "VideoWizard::openSceneTextInspector()"
      to: "$showSceneTextInspectorModal = true"
      via: "state mutation"
      pattern: "\\$this->showSceneTextInspectorModal\\s*="
    - from: scene-text-inspector.blade.php
      to: "$script['scenes'][$inspectorSceneIndex]"
      via: "direct array access for scene data"
      pattern: "\\$script\\['scenes'\\]\\[\\$inspectorSceneIndex\\]"
---

<objective>
Create working Scene Text Inspector modal shell with open/close functionality and scene header display.

Purpose: Establish modal foundation and backend state management following established Character Bible / Location Bible patterns. Validates Livewire integration and re-render performance before adding complex content.

Output: Functional modal that opens from scene card Inspect button, displays scene number/title, and closes via X button or ESC key with smooth scrolling.
</objective>

<execution_context>
@C:\Users\VoltaPsy\AppData\Roaming\Claude\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\VoltaPsy\AppData\Roaming\Claude\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\PROJECT.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\ROADMAP.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\STATE.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\REQUIREMENTS.md
@C:\Users\VoltaPsy\Documents\GitHub\artime\.planning\research\SUMMARY.md

Reference modal pattern from existing modals:
@C:\Users\VoltaPsy\Documents\GitHub\artime\modules\AppVideoWizard\resources\views\livewire\modals\character-bible.blade.php

VideoWizard.php context (modal patterns):
- Line 1024: `public bool $showCharacterBibleModal = false;`
- Line 14956-14973: openCharacterBibleModal() and closeCharacterBibleModal() methods
- Pattern: Boolean property + index property + open/close methods
</context>

<tasks>

<task type="auto">
  <name>Add Scene Text Inspector backend properties and methods to VideoWizard.php</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
    Add Scene Text Inspector state management following Character Bible pattern:

    1. Add properties near line 1024 (after $showCharacterBibleModal):
       ```php
       // Scene Text Inspector Modal
       public bool $showSceneTextInspectorModal = false;
       public ?int $inspectorSceneIndex = null;
       ```

    2. Add computed property for current scene data (CRITICAL - avoids payload bloat):
       ```php
       /**
        * Get scene data for inspector (computed to avoid serialization).
        * Uses computed property pattern to prevent 10-100KB payload on every request.
        */
       public function getInspectorSceneProperty(): ?array
       {
           if ($this->inspectorSceneIndex === null) {
               return null;
           }

           return [
               'script' => $this->script['scenes'][$this->inspectorSceneIndex] ?? null,
               'storyboard' => $this->storyboard[$this->inspectorSceneIndex] ?? null,
           ];
       }
       ```

    3. Add open method near line 14956 (after closeCharacterBibleModal):
       ```php
       /**
        * Open Scene Text Inspector modal for specific scene.
        * Called from storyboard scene card Inspect button.
        */
       public function openSceneTextInspector(int $sceneIndex): void
       {
           // Validate scene exists
           if (!isset($this->script['scenes'][$sceneIndex])) {
               $this->error = 'Scene not found';
               return;
           }

           $this->inspectorSceneIndex = $sceneIndex;
           $this->showSceneTextInspectorModal = true;
       }
       ```

    4. Add close method:
       ```php
       /**
        * Close Scene Text Inspector modal.
        * No rebuild needed - this is read-only inspection.
        */
       public function closeSceneTextInspector(): void
       {
           $this->showSceneTextInspectorModal = false;
           $this->inspectorSceneIndex = null;
       }
       ```

    Why computed property: Research identified payload bloat as CRITICAL pitfall. Public properties serialize on every Livewire request. Scene data can be 10-100KB. Computed properties are NOT serialized but computed on-demand in blade, preventing massive payloads.

    DO NOT add scene data to public properties - use computed property only.
  </action>
  <verify>
    ```bash
    cd "C:\Users\VoltaPsy\Documents\GitHub\artime" && grep -n "showSceneTextInspectorModal\|inspectorSceneIndex\|openSceneTextInspector\|closeSceneTextInspector\|getInspectorSceneProperty" modules/AppVideoWizard/app/Livewire/VideoWizard.php
    ```
    Confirm all properties and methods exist with correct signatures.
  </verify>
  <done>
    VideoWizard.php has Scene Text Inspector state management with boolean toggle, scene index tracking, computed property for scene data, and open/close methods following established modal patterns.
  </done>
</task>

<task type="auto">
  <name>Create Scene Text Inspector modal blade template</name>
  <files>modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php</files>
  <action>
    Create NEW file scene-text-inspector.blade.php following Character Bible modal structure:

    1. Modal overlay structure (following character-bible.blade.php lines 2-7):
       ```blade
       {{-- Scene Text Inspector Modal --}}
       @if($showSceneTextInspectorModal ?? false)
       <div class="vw-modal-overlay"
            x-data="{ show: @entangle('showSceneTextInspectorModal') }"
            x-show="show"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            @keydown.escape.window="$wire.closeSceneTextInspector()"
            wire:key="scene-inspector-{{ $inspectorSceneIndex ?? 'main' }}"
            style="position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 0.5rem;">
       ```

    2. Modal container with three-section layout:
       ```blade
       <div class="vw-modal"
            @click.outside="$wire.closeSceneTextInspector()"
            style="background: linear-gradient(135deg, rgba(30,30,45,0.98), rgba(20,20,35,0.99)); border: 1px solid rgba(139,92,246,0.3); border-radius: 0.75rem; width: 100%; max-width: 920px; max-height: 96vh; display: flex; flex-direction: column; overflow: hidden;">
       ```

    3. Fixed header section with scene number and title:
       ```blade
       {{-- Header --}}
       <div style="padding: 0.5rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
           @php
               $scene = $this->inspectorScene['script'] ?? null;
               $sceneNum = ($inspectorSceneIndex ?? 0) + 1;
           @endphp
           <div>
               <h3 style="margin: 0; color: white; font-size: 1rem; font-weight: 600;">
                   üîç Scene {{ $sceneNum }}{{ !empty($scene['title']) ? ': ' . $scene['title'] : '' }}
               </h3>
               <p style="margin: 0.15rem 0 0 0; color: rgba(255,255,255,0.6); font-size: 0.7rem;">
                   {{ __('Complete scene text, prompts, and metadata') }}
               </p>
           </div>
           <button type="button"
                   wire:click="closeSceneTextInspector"
                   style="background: none; border: none; color: white; font-size: 1.25rem; cursor: pointer; padding: 0.25rem; line-height: 1;">&times;</button>
       </div>
       ```

    4. Scrollable content section (placeholder for Plan 03):
       ```blade
       {{-- Content --}}
       <div style="flex: 1; overflow-y: auto; padding: 1rem;">
           @if($scene)
               {{-- Metadata section will be added in Plan 03 --}}
               <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 0.5rem; text-align: center; color: rgba(255,255,255,0.6);">
                   üìä Metadata display coming in Plan 03
               </div>
           @else
               <div style="padding: 2rem; text-align: center; color: rgba(255,255,255,0.4);">
                   {{ __('Scene not found') }}
               </div>
           @endif
       </div>
       ```

    5. Footer section (empty for now, future actions):
       ```blade
       {{-- Footer --}}
       <div style="padding: 0.5rem 1rem; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: flex-end; gap: 0.5rem; flex-shrink: 0;">
           <button type="button"
                   wire:click="closeSceneTextInspector"
                   style="padding: 0.4rem 0.8rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 0.375rem; color: white; font-size: 0.75rem; cursor: pointer;">
               {{ __('Close') }}
           </button>
       </div>
       ```

    6. Close modal container and overlay:
       ```blade
       </div>
       </div>
       @endif
       ```

    Why this structure: Matches established modal patterns (character-bible, location-bible) for consistency. Three-section layout (fixed header, scrollable content, fixed footer) is the standard pattern. Alpine.js x-transition provides smooth animations. @keydown.escape and @click.outside handle close UX.

    IMPORTANT: Use computed property `$this->inspectorScene` NOT direct array access to avoid re-computation on every render.
  </action>
  <verify>
    ```bash
    cd "C:\Users\VoltaPsy\Documents\GitHub\artime" && ls -la modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php && wc -l modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
    ```
    Confirm file exists and has ~80-100 lines.
  </verify>
  <done>
    scene-text-inspector.blade.php modal template created with three-section layout, Alpine.js animations, ESC/click-outside close handlers, scene header display, and placeholder content area for Plan 03.
  </done>
</task>

<task type="auto">
  <name>Include Scene Text Inspector modal in main video-wizard layout</name>
  <files>modules/AppVideoWizard/resources/views/livewire/video-wizard.blade.php</files>
  <action>
    Include the Scene Text Inspector modal in the main layout:

    1. Find the section where other modals are included (search for character-bible, location-bible includes)

    2. Add include statement in same pattern:
       ```blade
       {{-- Scene Text Inspector Modal --}}
       @include('appvideowizard::livewire.modals.scene-text-inspector')
       ```

    3. Place after Character Bible modal include and before closing main wrapper

    Why: Modals are rendered outside main content flow at end of layout. This ensures z-index stacking and overlay positioning work correctly. Following existing modal include pattern ensures consistency.
  </action>
  <verify>
    ```bash
    cd "C:\Users\VoltaPsy\Documents\GitHub\artime" && grep -n "scene-text-inspector" modules/AppVideoWizard/resources/views/livewire/video-wizard.blade.php
    ```
    Confirm modal is included in video-wizard.blade.php.
  </verify>
  <done>
    Scene Text Inspector modal included in main video-wizard layout following established modal include pattern, ensuring correct rendering order and z-index stacking.
  </done>
</task>

</tasks>

<verification>
Integration test after execution:
1. Start Laravel dev server: `php artisan serve`
2. Open Video Wizard, navigate to Storyboard step
3. Click Inspect button on any scene card
4. Verify:
   - Modal opens immediately with fade-in animation
   - Scene number and title displayed correctly in header
   - Close button (X) works
   - ESC key closes modal
   - Click outside modal closes it
   - Modal content area is scrollable
   - Body scroll is locked when modal open
   - No console errors
   - Network tab shows reasonable payload (<50KB for modal open)
</verification>

<success_criteria>
- User can click Inspect button and modal opens with <300ms delay
- Modal displays correct scene number (1-based indexing) and title from script
- Close button (X) closes modal immediately
- ESC key closes modal
- Click outside modal closes it
- Modal uses three-section layout (fixed header, scrollable content, fixed footer)
- Computed property prevents payload bloat (network requests <50KB)
- Modal follows established patterns from Character Bible/Location Bible modals
- No Livewire re-render cascade (no screen flash on open)
</success_criteria>

<output>
After completion, create `.planning/phases/07-foundation-modal-shell-scene-card-fixes-metadata/07-02-SUMMARY.md`
</output>
