---
phase: 24-video-temporal-expansion
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Services/TransitionVocabulary.php
  - modules/AppVideoWizard/app/Services/CameraMovementService.php
  - tests/Unit/VideoWizard/TransitionVocabularyTest.php
  - tests/Unit/VideoWizard/CameraMovementServiceTemporalTest.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Each shot has transition suggestions describing ending state"
    - "Camera movements include duration in prompt (e.g., 'dolly in over 4 seconds')"
    - "Camera movements include psychological purpose (e.g., 'creating intimacy')"
    - "Transition vocabulary includes match cut, hard cut, and soft transition setups"
  artifacts:
    - path: "modules/AppVideoWizard/app/Services/TransitionVocabulary.php"
      provides: "Shot ending states and transition motivation vocabulary"
      exports: ["buildTransitionSetup", "TRANSITION_MOTIVATIONS", "SHOT_ENDING_STATES"]
    - path: "modules/AppVideoWizard/app/Services/CameraMovementService.php"
      provides: "Extended camera movement with duration and psychology"
      exports: ["buildTemporalMovementPrompt"]
  key_links:
    - from: "TransitionVocabulary"
      to: "TRANSITION_MOTIVATIONS"
      via: "buildTransitionSetup selects motivation type"
      pattern: "TRANSITION_MOTIVATIONS\\[.*\\]"
    - from: "CameraMovementService"
      to: "VwCameraMovement model"
      via: "buildTemporalMovementPrompt uses typical_duration_* fields"
      pattern: "typical_duration"
---

<objective>
Create TransitionVocabulary for shot ending states and extend CameraMovementService with duration + psychology in prompts.

Purpose: VID-03 (camera movement with duration and psychology) and VID-07 (transition suggestions) require vocabulary for describing how shots end and how camera movements communicate emotion over time.

Output: New TransitionVocabulary service and extended CameraMovementService with temporal prompt building, with unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-video-temporal-expansion/24-RESEARCH.md

# Existing services to extend
@modules/AppVideoWizard/app/Services/CameraMovementService.php (existing, extend)
@modules/AppVideoWizard/database/seeders/VwCameraMovementSeeder.php (has typical_duration_*, best_for_emotions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TransitionVocabulary</name>
  <files>
    modules/AppVideoWizard/app/Services/TransitionVocabulary.php
    tests/Unit/VideoWizard/TransitionVocabularyTest.php
  </files>
  <action>
Create TransitionVocabulary for shot ending states and transition motivations.

NOTE: This is NOT for describing dissolves/wipes in video prompts (those are post-production). This describes how shots END to motivate editorial cuts.

Constants to define (from research):
```php
const TRANSITION_MOTIVATIONS = [
    'match_cut_setup' => [
        'shape' => 'ends on circular object or shape that echoes into next shot',
        'motion' => 'ends mid-movement, action continues in next shot',
        'color' => 'ends with dominant color that carries through transition',
        'eyeline' => 'ends with character looking at specific point, next shot reveals object of gaze',
    ],
    'hard_cut_setup' => [
        'action_peak' => 'ends at peak moment of action for impactful cut',
        'look_off' => 'character looks off-frame, motivating cut to what they see',
        'reaction_held' => 'holds on reaction beat for 1-2 seconds, allowing clean cut away',
        'dialogue_end' => 'ends on final word of dialogue, natural pause for cut',
    ],
    'soft_transition_setup' => [
        'settle' => 'action settles to stillness, supporting gentle transition',
        'fade_worthy' => 'ends on contemplative beat, supporting fade to next scene',
        'environmental_rest' => 'camera comes to rest on environmental detail',
    ],
];

const SHOT_ENDING_STATES = [
    'look_direction' => 'exits looking {direction}, motivating cut to subject of gaze',
    'mid_motion' => 'ends mid-gesture, next shot can complete action',
    'emotional_peak' => 'holds on emotional high point for {duration} seconds before cut',
    'environmental_pan' => 'camera movement ends revealing new element in environment',
    'settling' => 'subject settles into stillness, breathing visible, ready for transition',
    'departure' => 'subject begins exit from frame, cut before complete departure',
];

const NEXT_SHOT_SUGGESTIONS = [
    'look_direction' => 'Cut to: POV of what character sees, or reaction shot',
    'mid_motion' => 'Cut to: Completion of action from new angle',
    'emotional_peak' => 'Cut to: Reaction shot or environmental breathing room',
    'environmental_pan' => 'Cut to: Detail shot of revealed element',
    'settling' => 'Cut to: Wide establishing or time passage',
    'departure' => 'Cut to: Destination or reaction of those left behind',
];
```

Methods to implement:
1. `buildTransitionSetup(string $transitionType, string $variant, array $parameters = []): string` - Returns ending state description
2. `suggestTransitionForMood(string $mood): string` - Returns recommended transition type (match_cut_setup for energetic, soft_transition_setup for contemplative)
3. `getNextShotSuggestion(string $endingState): string` - Returns editorial guidance for next shot
4. `buildEndingStateDescription(string $state, array $parameters = []): string` - Fills parameters into ending state template

Unit tests (5 tests):
- testBuildTransitionSetupForMatchCut
- testBuildTransitionSetupForHardCut
- testSuggestTransitionForMoodMatchesCorrectType
- testGetNextShotSuggestionReturnsEditorialGuidance
- testBuildEndingStateSubstitutesParameters
  </action>
  <verify>
    grep -q "TRANSITION_MOTIVATIONS" modules/AppVideoWizard/app/Services/TransitionVocabulary.php
    grep -q "SHOT_ENDING_STATES" modules/AppVideoWizard/app/Services/TransitionVocabulary.php
    grep -q "buildTransitionSetup" modules/AppVideoWizard/app/Services/TransitionVocabulary.php
    grep -q "class TransitionVocabularyTest" tests/Unit/VideoWizard/TransitionVocabularyTest.php
  </verify>
  <done>TransitionVocabulary exists with TRANSITION_MOTIVATIONS, SHOT_ENDING_STATES constants and buildTransitionSetup, getNextShotSuggestion methods. Tests verify transition setup building.</done>
</task>

<task type="auto">
  <name>Task 2: Extend CameraMovementService with Temporal Prompt Building</name>
  <files>
    modules/AppVideoWizard/app/Services/CameraMovementService.php
    tests/Unit/VideoWizard/CameraMovementServiceTemporalTest.php
  </files>
  <action>
Extend existing CameraMovementService to add duration and psychological purpose to movement prompts.

Add new constant for psychological purposes:
```php
const MOVEMENT_PSYCHOLOGY = [
    'intimacy' => 'closing distance as emotional connection deepens',
    'tension' => 'building suspense through deliberate approach',
    'reveal' => 'gradually exposing the full scope of the scene',
    'isolation' => 'emphasizing loneliness through widening space',
    'power' => 'asserting dominance through elevated perspective',
    'vulnerability' => 'exposing fragility through descending motion',
    'urgency' => 'conveying time pressure through accelerating movement',
    'contemplation' => 'allowing space for thought through measured pacing',
    'discovery' => 'following curiosity through exploratory motion',
    'departure' => 'marking farewell through receding distance',
];
```

Add new method (DO NOT modify existing buildMovementPrompt - add new method):
```php
/**
 * Build movement prompt with explicit duration and psychological purpose.
 * VID-03: Camera movement includes duration and psychological purpose.
 *
 * @param string $movementSlug Movement type
 * @param int $durationSeconds Duration in seconds
 * @param string $emotionalPurpose Psychology key from MOVEMENT_PSYCHOLOGY
 * @param string $intensity Optional intensity override
 * @return string Full movement prompt with duration and psychology
 */
public function buildTemporalMovementPrompt(
    string $movementSlug,
    int $durationSeconds,
    string $emotionalPurpose,
    string $intensity = 'moderate'
): string
```

Implementation:
1. Get base movement from VwCameraMovement model
2. Get duration bounds from typical_duration_min/max, clamp durationSeconds
3. Replace "smoothly" in prompt_syntax with "over {$durationSeconds} seconds"
4. Append psychological purpose from MOVEMENT_PSYCHOLOGY
5. Add intensity modifier if not moderate

Example output:
- "camera dollies in over 4 seconds, closing distance as emotional connection deepens"
- "camera dramatically cranes up over 6 seconds, asserting dominance through elevated perspective"

Also add helper method:
```php
/**
 * Get recommended duration for movement type and clip length.
 */
public function getRecommendedDuration(string $movementSlug, int $clipDurationSeconds): int
```

This should:
1. Get typical_duration_min/max from VwCameraMovement
2. Scale to clip duration (movement shouldn't exceed 80% of clip)
3. Return clamped value

Unit tests (5 tests, in NEW test file CameraMovementServiceTemporalTest.php):
- testBuildTemporalMovementPromptIncludesDuration
- testBuildTemporalMovementPromptIncludesPsychology
- testBuildTemporalMovementPromptClampsToTypicalDuration
- testGetRecommendedDurationScalesToClipLength
- testBuildTemporalMovementPromptHandlesIntensity

DO NOT modify existing tests in CameraMovementServiceTest.php - create new test file.
  </action>
  <verify>
    grep -q "MOVEMENT_PSYCHOLOGY" modules/AppVideoWizard/app/Services/CameraMovementService.php
    grep -q "buildTemporalMovementPrompt" modules/AppVideoWizard/app/Services/CameraMovementService.php
    grep -q "getRecommendedDuration" modules/AppVideoWizard/app/Services/CameraMovementService.php
    grep -q "over.*seconds" modules/AppVideoWizard/app/Services/CameraMovementService.php
    grep -q "class CameraMovementServiceTemporalTest" tests/Unit/VideoWizard/CameraMovementServiceTemporalTest.php
  </verify>
  <done>CameraMovementService extended with MOVEMENT_PSYCHOLOGY constant, buildTemporalMovementPrompt and getRecommendedDuration methods. New test file verifies duration and psychology in movement prompts.</done>
</task>

</tasks>

<verification>
1. TransitionVocabulary.php exists with TRANSITION_MOTIVATIONS, SHOT_ENDING_STATES, NEXT_SHOT_SUGGESTIONS
2. CameraMovementService.php has new MOVEMENT_PSYCHOLOGY constant and buildTemporalMovementPrompt method
3. Existing CameraMovementService methods untouched (buildMovementPrompt still works)
4. New tests verify temporal features without modifying existing tests
5. Movement prompts include duration ("over 4 seconds") and psychology ("creating intimacy")
</verification>

<success_criteria>
- TransitionVocabulary.buildTransitionSetup produces ending state descriptions like "ends mid-movement, action continues in next shot"
- TransitionVocabulary.getNextShotSuggestion provides editorial guidance
- CameraMovementService.buildTemporalMovementPrompt produces prompts like "camera dollies in over 4 seconds, closing distance as emotional connection deepens"
- Duration is clamped to typical_duration_min/max from VwCameraMovement model
- All existing CameraMovementService tests still pass
- All new tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/24-video-temporal-expansion/24-03-SUMMARY.md`
</output>
