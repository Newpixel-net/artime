---
phase: 24-video-temporal-expansion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Services/CharacterDynamicsService.php
  - modules/AppVideoWizard/app/Services/CharacterPathService.php
  - tests/Unit/VideoWizard/CharacterDynamicsServiceTest.php
  - tests/Unit/VideoWizard/CharacterPathServiceTest.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Multi-character shots describe explicit proxemic zones (intimate, personal, social, public)"
    - "Power dynamics describe frame positioning (dominant higher/centered, subordinate lower/edge)"
    - "Character paths describe movement trajectories within frame"
    - "Mirroring and alliance postures are explicitly described"
  artifacts:
    - path: "modules/AppVideoWizard/app/Services/CharacterDynamicsService.php"
      provides: "Multi-character spatial relationships and power dynamics vocabulary"
      exports: ["buildSpatialDynamics", "PROXEMIC_ZONES", "POWER_POSITIONING"]
    - path: "modules/AppVideoWizard/app/Services/CharacterPathService.php"
      provides: "Character movement path vocabulary"
      exports: ["buildCharacterPath", "CHARACTER_PATH_VOCABULARY"]
  key_links:
    - from: "CharacterDynamicsService"
      to: "PROXEMIC_ZONES"
      via: "buildSpatialDynamics uses zone prompts"
      pattern: "PROXEMIC_ZONES\\[.*\\]\\['prompt'\\]"
    - from: "CharacterPathService"
      to: "CHARACTER_PATH_VOCABULARY"
      via: "buildCharacterPath selects from vocabulary"
      pattern: "CHARACTER_PATH_VOCABULARY\\[.*\\]"
---

<objective>
Create CharacterDynamicsService for multi-character spatial relationships and CharacterPathService for movement trajectories.

Purpose: VID-04 (character movement paths) and VID-05 (inter-character dynamics) require explicit spatial vocabulary. AI models struggle with implicit relationships - must describe "dominant character positioned higher in frame" not just "boss and employee talking."

Output: Two new services with constants for proxemics, power positioning, and movement paths, with unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-video-temporal-expansion/24-RESEARCH.md

# Source for patterns
@modules/AppVideoWizard/app/Services/CharacterPsychologyService.php (emotion mapping pattern)
@modules/AppVideoWizard/app/Services/MiseEnSceneService.php (environment vocabulary pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CharacterDynamicsService</name>
  <files>
    modules/AppVideoWizard/app/Services/CharacterDynamicsService.php
    tests/Unit/VideoWizard/CharacterDynamicsServiceTest.php
  </files>
  <action>
Create CharacterDynamicsService for multi-character spatial relationships.

Constants to define (from research - Edward Hall's proxemics + film blocking):
```php
const PROXEMIC_ZONES = [
    'intimate' => [
        'distance' => '0-18 inches',
        'prompt' => 'close enough to feel breath, faces nearly touching',
        'use_for' => ['love', 'comfort', 'confrontation', 'secrets'],
    ],
    'personal' => [
        'distance' => '18 inches - 4 feet',
        'prompt' => 'at arm\'s length distance, personal space shared',
        'use_for' => ['friends', 'close_conversation', 'collaboration'],
    ],
    'social' => [
        'distance' => '4-12 feet',
        'prompt' => 'at conversational distance, professional spacing',
        'use_for' => ['business', 'formal', 'acquaintances'],
    ],
    'public' => [
        'distance' => '12+ feet',
        'prompt' => 'distant separation, vast space between them',
        'use_for' => ['strangers', 'formal_address', 'isolation'],
    ],
];

const POWER_POSITIONING = [
    'dominant_over_subordinate' => [
        'dominant' => 'positioned higher in frame, chin raised, occupying more frame space',
        'subordinate' => 'positioned lower, eyeline directed upward, compressed into corner of frame',
    ],
    'equals' => [
        'description' => 'positioned at same height, equal frame space, facing each other directly',
    ],
    'conflict' => [
        'description' => 'bodies angled away but heads turned toward each other, physical barrier between them',
    ],
    'alliance' => [
        'description' => 'mirroring each other\'s posture, bodies angled same direction, shoulders aligned',
    ],
    'protector_protected' => [
        'protector' => 'positioned between threat and protected, body angled as shield',
        'protected' => 'positioned behind protector, partially obscured by their form',
    ],
];

const RELATIONSHIP_TO_PROXIMITY = [
    'lovers' => 'intimate',
    'friends' => 'personal',
    'colleagues' => 'social',
    'strangers' => 'public',
    'enemies' => 'social',  // Ironically, enemies need social distance in confrontation
    'mentor_student' => 'personal',
    'boss_employee' => 'social',
];
```

Methods to implement:
1. `buildSpatialDynamics(string $relationship, string $proximityZone, array $characters): string` - Returns full spatial dynamics description
2. `getProximityForRelationship(string $relationship): string` - Maps relationship type to proxemic zone
3. `buildPowerDescription(string $powerDynamic, array $characters): string` - Returns power positioning description with character names
4. `suggestDynamicsForScene(string $sceneType, array $characters): array` - Returns suggested proximity and power for scene type

Unit tests (5 tests):
- testBuildSpatialDynamicsForDominantSubordinate
- testBuildSpatialDynamicsForEquals
- testGetProximityForRelationshipMapsCorrectly
- testBuildPowerDescriptionIncludesCharacterNames
- testSuggestDynamicsForConfrontationScene

Follow MiseEnSceneService pattern for vocabulary constants.
  </action>
  <verify>
    grep -q "PROXEMIC_ZONES" modules/AppVideoWizard/app/Services/CharacterDynamicsService.php
    grep -q "POWER_POSITIONING" modules/AppVideoWizard/app/Services/CharacterDynamicsService.php
    grep -q "buildSpatialDynamics" modules/AppVideoWizard/app/Services/CharacterDynamicsService.php
    grep -q "class CharacterDynamicsServiceTest" tests/Unit/VideoWizard/CharacterDynamicsServiceTest.php
  </verify>
  <done>CharacterDynamicsService exists with PROXEMIC_ZONES, POWER_POSITIONING constants and buildSpatialDynamics method. Tests verify spatial dynamics include proxemics and power positioning.</done>
</task>

<task type="auto">
  <name>Task 2: Create CharacterPathService</name>
  <files>
    modules/AppVideoWizard/app/Services/CharacterPathService.php
    tests/Unit/VideoWizard/CharacterPathServiceTest.php
  </files>
  <action>
Create CharacterPathService for character movement trajectory vocabulary.

Constants to define (from research):
```php
const CHARACTER_PATH_VOCABULARY = [
    'approach' => [
        'toward_camera' => 'walks directly toward camera, growing larger in frame',
        'diagonal_entry' => 'enters frame from lower left, moving diagonally toward upper right',
        'lateral_approach' => 'approaches from the side, moving into personal space',
    ],
    'retreat' => [
        'away_from_camera' => 'backs away from camera, shrinking in frame',
        'exit_frame' => 'exits frame, gaze lingering before departure',
        'turn_and_walk' => 'turns and walks away, back to camera',
    ],
    'stationary_motion' => [
        'turn' => 'turns {degrees} degrees to face {direction}',
        'rise' => 'rises from seated position to standing',
        'settle' => 'settles into position, weight shifting back',
        'shift_weight' => 'shifts weight from one foot to the other',
        'lean' => 'leans {direction}, changing center of gravity',
    ],
    'crossing' => [
        'left_to_right' => 'crosses frame from left to right, maintaining consistent distance',
        'right_to_left' => 'crosses frame from right to left, maintaining consistent distance',
        'foreground_cross' => 'crosses close to camera in foreground, momentarily filling frame',
        'background_cross' => 'crosses in background, smaller figure moving through scene',
    ],
    'gestural' => [
        'reach' => 'reaches {direction} with {hand}, extending into space',
        'point' => 'points {direction}, arm extending to indicate',
        'embrace_open' => 'opens arms in welcoming gesture',
        'defensive_cross' => 'crosses arms defensively, closing off body language',
    ],
];

const PATH_DURATION_ESTIMATES = [
    'approach' => ['min' => 3, 'max' => 5],
    'retreat' => ['min' => 2, 'max' => 4],
    'stationary_motion' => ['min' => 1, 'max' => 3],
    'crossing' => ['min' => 3, 'max' => 6],
    'gestural' => ['min' => 1, 'max' => 2],
];
```

Methods to implement:
1. `buildCharacterPath(string $pathType, string $variant, array $parameters = []): string` - Returns path description with parameters filled
2. `suggestPathForIntent(string $intent): array` - Returns ['path_type' => string, 'variant' => string] for intent like 'enter_scene', 'leave', 'confront'
3. `estimatePathDuration(string $pathType): array` - Returns ['min' => int, 'max' => int] duration estimate
4. `combinePathWithCamera(string $pathDescription, string $cameraMovement): string` - Combines character path with camera movement coherently

Intent mapping:
```php
const INTENT_TO_PATH = [
    'enter_scene' => ['approach', 'diagonal_entry'],
    'leave_scene' => ['retreat', 'exit_frame'],
    'confront' => ['approach', 'toward_camera'],
    'avoid' => ['retreat', 'turn_and_walk'],
    'observe' => ['stationary_motion', 'turn'],
    'react' => ['stationary_motion', 'shift_weight'],
];
```

Unit tests (5 tests):
- testBuildCharacterPathSubstitutesParameters
- testSuggestPathForIntentReturnsValidPath
- testEstimatePathDurationReturnsMinMax
- testCombinePathWithCameraProducesCoherentDescription
- testPathVocabularyCoversAllMovementTypes

Follow VideoPromptBuilderService pattern for vocabulary organization.
  </action>
  <verify>
    grep -q "CHARACTER_PATH_VOCABULARY" modules/AppVideoWizard/app/Services/CharacterPathService.php
    grep -q "buildCharacterPath" modules/AppVideoWizard/app/Services/CharacterPathService.php
    grep -q "PATH_DURATION_ESTIMATES" modules/AppVideoWizard/app/Services/CharacterPathService.php
    grep -q "class CharacterPathServiceTest" tests/Unit/VideoWizard/CharacterPathServiceTest.php
  </verify>
  <done>CharacterPathService exists with CHARACTER_PATH_VOCABULARY, PATH_DURATION_ESTIMATES constants and buildCharacterPath method. Tests verify path building with parameter substitution.</done>
</task>

</tasks>

<verification>
1. CharacterDynamicsService.php exists with PROXEMIC_ZONES, POWER_POSITIONING, buildSpatialDynamics methods
2. CharacterPathService.php exists with CHARACTER_PATH_VOCABULARY, PATH_DURATION_ESTIMATES, buildCharacterPath methods
3. Both services have unit tests
4. Proxemic zones match Edward Hall's research (intimate 0-18", personal 18"-4', social 4-12', public 12'+)
5. Power positioning includes dominant/subordinate, equals, conflict, alliance patterns
6. Character paths include approach, retreat, stationary_motion, crossing, gestural categories
</verification>

<success_criteria>
- CharacterDynamicsService.buildSpatialDynamics produces prompts like "Characters positioned at arm's length distance, personal space shared. Marcus positioned higher in frame, chin raised..."
- CharacterPathService.buildCharacterPath substitutes parameters correctly ("turns 45 degrees to face left")
- Duration estimates align with VideoTemporalService guidelines (2-5 seconds for most paths)
- All unit tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/24-video-temporal-expansion/24-02-SUMMARY.md`
</output>
