---
phase: 03-hollywood-production-system
plan: 04
type: execute
wave: 3
depends_on: ["03-01", "03-02", "03-03"]
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
  - modules/AppVideoWizard/resources/views/livewire/video-wizard.blade.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Auto-proceed toggle exists in UI"
    - "When script generation completes AND auto-proceed is ON, storyboard generation starts automatically"
    - "When storyboard completes AND auto-proceed is ON, animation starts automatically"
    - "Progress indicator shows overall pipeline status"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "Auto-proceed logic between wizard steps"
      contains: "autoProceedEnabled"
  key_links:
    - from: "VideoWizard.php"
      to: "generateScript completion"
      via: "auto-proceed trigger"
      pattern: "autoProceedEnabled"
---

<objective>
Add auto-proceed functionality so the wizard flows automatically through steps.

**PROBLEM:** Currently users must manually click through each step:
1. Click "Generate Script" → wait → manually go to Storyboard
2. Click "Generate Images" → wait → manually go to Animation
3. Click "Animate" → wait → manually go to Assembly

Purpose: Enable one-click flow from concept to near-final video with optional review checkpoints.

Output: When auto-proceed is ON, completing one step automatically starts the next.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/PIPELINE-AUDIT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto-proceed property and toggle</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a new property for auto-proceed mode. Find the properties section (near other boolean flags) and add:

```php
/**
 * PHASE 3: Auto-proceed through wizard steps.
 * When enabled, completing one step automatically starts the next.
 */
public bool $autoProceedEnabled = false;
```

Also add it to the rules if there's a $rules array, and to any save/load methods.

WHY: This flag controls the automatic flow behavior.
  </action>
  <verify>
    - `$autoProceedEnabled` property exists
    - Property is public bool with default false
    - No PHP syntax errors
  </verify>
  <done>Auto-proceed property added</done>
</task>

<task type="auto">
  <name>Task 2: Add auto-proceed after script generation</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Find the `generateScript()` method completion point. After the script is successfully generated and saved, add:

```php
// PHASE 3: Auto-proceed to storyboard if enabled
if ($this->autoProceedEnabled && !empty($this->script['scenes'])) {
    Log::info('VideoWizard: Auto-proceeding to Storyboard step');
    $this->goToStep(4); // Storyboard step

    // Dispatch event to trigger auto-population of Scene Memory
    $this->dispatch('auto-proceed-storyboard');
}
```

Also add a listener for auto-proceed-storyboard that starts batch image generation:

```php
#[On('auto-proceed-storyboard')]
public function handleAutoProceedStoryboard(): void
{
    if ($this->autoProceedEnabled) {
        // Wait a moment for Scene Memory to populate, then start batch generation
        $this->dispatch('start-batch-image-generation');
    }
}
```

WHY: When script completes, automatically move to storyboard and start generating.
  </action>
  <verify>
    - Auto-proceed check exists after script generation
    - `goToStep(4)` is called when auto-proceed is on
    - Event dispatched to trigger storyboard generation
    - No PHP syntax errors
  </verify>
  <done>Auto-proceed triggers after script generation</done>
</task>

<task type="auto">
  <name>Task 3: Add auto-proceed after storyboard completion</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Find where storyboard/image generation completes (likely in a method that handles batch completion or individual image completion). Add:

```php
// PHASE 3: Auto-proceed to animation if all images are done
if ($this->autoProceedEnabled && $this->allScenesHaveImages()) {
    Log::info('VideoWizard: Auto-proceeding to Animation step');
    $this->goToStep(5); // Animation step

    // Dispatch event to trigger batch video generation
    $this->dispatch('auto-proceed-animation');
}
```

Add the helper method:

```php
/**
 * Check if all scenes have generated images.
 */
protected function allScenesHaveImages(): bool
{
    if (empty($this->storyboard['scenes'])) {
        return false;
    }

    foreach ($this->storyboard['scenes'] as $scene) {
        // Check if scene has imageUrl OR all shots have images
        if (empty($scene['imageUrl'])) {
            $shots = $scene['shots'] ?? [];
            if (empty($shots)) {
                return false;
            }
            foreach ($shots as $shot) {
                if (empty($shot['imageUrl'])) {
                    return false;
                }
            }
        }
    }

    return true;
}
```

And the listener:

```php
#[On('auto-proceed-animation')]
public function handleAutoProceedAnimation(): void
{
    if ($this->autoProceedEnabled) {
        // Start batch video generation
        $this->dispatch('start-batch-video-generation');
    }
}
```

WHY: When all images are done, automatically move to animation.
  </action>
  <verify>
    - Auto-proceed check exists after all images complete
    - `allScenesHaveImages()` helper method exists
    - `goToStep(5)` is called when auto-proceed is on
    - No PHP syntax errors
  </verify>
  <done>Auto-proceed triggers after storyboard completion</done>
</task>

<task type="auto">
  <name>Task 4: Add auto-proceed after animation completion</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Find where animation/video generation completes. Add:

```php
// PHASE 3: Auto-proceed to assembly if all videos are done
if ($this->autoProceedEnabled && $this->allScenesHaveVideos()) {
    Log::info('VideoWizard: Auto-proceeding to Assembly step');
    $this->goToStep(6); // Assembly step

    // Show notification that auto-generation is complete
    $this->dispatch('notify', [
        'type' => 'success',
        'message' => 'Auto-generation complete! Review your video in Assembly.',
    ]);
}
```

Add the helper method:

```php
/**
 * Check if all scenes have generated videos.
 */
protected function allScenesHaveVideos(): bool
{
    if (empty($this->animation['scenes'])) {
        return false;
    }

    foreach ($this->animation['scenes'] as $scene) {
        if (empty($scene['videoUrl'])) {
            return false;
        }
    }

    return true;
}
```

WHY: When all videos are done, automatically move to assembly for review.
  </action>
  <verify>
    - Auto-proceed check exists after all videos complete
    - `allScenesHaveVideos()` helper method exists
    - `goToStep(6)` is called when auto-proceed is on
    - Notification dispatched
    - No PHP syntax errors
  </verify>
  <done>Auto-proceed triggers after animation completion</done>
</task>

<task type="auto">
  <name>Task 5: Add overall progress indicator property</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a computed property or method for overall pipeline progress:

```php
/**
 * PHASE 3: Get overall pipeline progress as percentage.
 * Weights: Script 20%, Storyboard 40%, Animation 30%, Assembly 10%
 */
public function getOverallProgressProperty(): array
{
    $progress = [
        'percentage' => 0,
        'stage' => 'Not started',
        'details' => [],
    ];

    // Script progress (20%)
    $scriptProgress = !empty($this->script['scenes']) ? 100 : 0;
    $progress['details']['script'] = $scriptProgress;
    $progress['percentage'] += $scriptProgress * 0.20;

    // Storyboard progress (40%)
    $storyboardProgress = $this->calculateStoryboardProgress();
    $progress['details']['storyboard'] = $storyboardProgress;
    $progress['percentage'] += $storyboardProgress * 0.40;

    // Animation progress (30%)
    $animationProgress = $this->calculateAnimationProgress();
    $progress['details']['animation'] = $animationProgress;
    $progress['percentage'] += $animationProgress * 0.30;

    // Assembly progress (10%)
    $assemblyProgress = $this->currentStep >= 6 ? 100 : 0;
    $progress['details']['assembly'] = $assemblyProgress;
    $progress['percentage'] += $assemblyProgress * 0.10;

    // Determine current stage
    if ($progress['percentage'] >= 100) {
        $progress['stage'] = 'Complete';
    } elseif ($animationProgress > 0) {
        $progress['stage'] = 'Animating';
    } elseif ($storyboardProgress > 0) {
        $progress['stage'] = 'Generating images';
    } elseif ($scriptProgress > 0) {
        $progress['stage'] = 'Script ready';
    }

    $progress['percentage'] = round($progress['percentage']);

    return $progress;
}

protected function calculateStoryboardProgress(): float
{
    if (empty($this->storyboard['scenes'])) {
        return 0;
    }

    $total = count($this->storyboard['scenes']);
    $completed = 0;

    foreach ($this->storyboard['scenes'] as $scene) {
        if (!empty($scene['imageUrl'])) {
            $completed++;
        } else {
            // Check multi-shot mode
            $shots = $scene['shots'] ?? [];
            if (!empty($shots)) {
                $shotsDone = count(array_filter($shots, fn($s) => !empty($s['imageUrl'])));
                $completed += $shotsDone / count($shots);
            }
        }
    }

    return ($completed / $total) * 100;
}

protected function calculateAnimationProgress(): float
{
    if (empty($this->animation['scenes'])) {
        return 0;
    }

    $total = count($this->animation['scenes']);
    $completed = count(array_filter($this->animation['scenes'], fn($s) => !empty($s['videoUrl'])));

    return ($completed / $total) * 100;
}
```

WHY: Users need to see overall progress, especially in auto-proceed mode.
  </action>
  <verify>
    - `getOverallProgressProperty()` method exists
    - Returns percentage, stage, and details
    - `calculateStoryboardProgress()` and `calculateAnimationProgress()` exist
    - No PHP syntax errors
  </verify>
  <done>Overall progress indicator added</done>
</task>

</tasks>

<verification>
1. PHP syntax check: `php -l modules/AppVideoWizard/app/Livewire/VideoWizard.php`
2. Grep for auto-proceed:
   - `grep -n "autoProceedEnabled" modules/AppVideoWizard/app/Livewire/VideoWizard.php`
   - `grep -n "auto-proceed" modules/AppVideoWizard/app/Livewire/VideoWizard.php`
3. All helper methods exist:
   - `allScenesHaveImages()`
   - `allScenesHaveVideos()`
   - `getOverallProgressProperty()`
</verification>

<success_criteria>
- Auto-proceed property exists and defaults to false
- Script completion can trigger storyboard start
- Storyboard completion can trigger animation start
- Animation completion can trigger assembly navigation
- Overall progress percentage available
- PHP syntax valid
</success_criteria>

<output>
After completion, create `.planning/phases/03-hollywood-production-system/03-04-SUMMARY.md`
</output>
