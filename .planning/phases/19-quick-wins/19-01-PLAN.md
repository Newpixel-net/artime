---
phase: 19-quick-wins
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Properties marked with #[Locked] do not serialize on every Livewire request"
    - "Derived values use #[Computed] and only recalculate when explicitly called"
    - "Constants remain accessible but are excluded from component state"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "Livewire 3 attributes applied to component"
      contains: "#[Locked]"
  key_links:
    - from: "VideoWizard.php"
      to: "Livewire 3 serialization"
      via: "#[Locked] attribute on read-only properties"
      pattern: "#\\[Locked\\]"
---

<objective>
Apply Livewire 3 attributes (#[Locked], #[Computed]) to VideoWizard component to reduce serialization payload.

Purpose: Properties marked #[Locked] are excluded from serialization on every request. #[Computed] values are cached and only recalculated when explicitly requested. This directly reduces the 500KB-2MB payload identified in debug analysis.

Output: VideoWizard.php with Livewire 3 attributes applied to appropriate properties.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@modules/AppVideoWizard/app/Livewire/VideoWizard.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add #[Locked] attributes to read-only properties</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add the Locked attribute import at the top of the file:
```php
use Livewire\Attributes\Locked;
```

Apply #[Locked] attribute to these constant-like properties that should NEVER be modified by the frontend:

1. **Static configurations (public const already excluded, but array configs are not):**
   - Do NOT add #[Locked] to actual `const` declarations (they're already excluded)
   - Add #[Locked] to any public array properties that act as configuration and never change:
     - `$suggestedSettings` (populated once during concept analysis)
     - `$productionIntelligence` (auto-populated defaults)
     - `$cinematicAnalysis` (populated once during analysis)

2. **Detection/status arrays that are read-only UI displays:**
   - `$detectionSummary` - populated after script parsing, read-only display
   - `$voiceStatus` - computed status for display
   - `$voiceContinuityValidation` - validation results, read-only

3. **Dynamic settings loaded once on mount:**
   - `$availableTtsVoices` - loaded from VoiceoverService, never modified by user

Example syntax:
```php
#[Locked]
public array $detectionSummary = [
    'characters' => [],
    'speechTypes' => [],
    // ...
];
```

IMPORTANT: Do NOT add #[Locked] to:
- Properties users actively modify (concept, script, storyboard, animation, assembly, sceneMemory)
- Modal state properties (showCharacterBibleModal, etc.)
- UI state (isLoading, error, etc.)
- The actual `const` declarations (they're already excluded from serialization)
  </action>
  <verify>
Run `php artisan tinker` and instantiate the component to verify no errors:
```
$component = new \Modules\AppVideoWizard\Livewire\VideoWizard();
```
No PHP errors should occur.
  </verify>
  <done>At least 6 public array properties have #[Locked] attribute applied. Properties are excluded from Livewire serialization while remaining accessible in Blade templates.</done>
</task>

<task type="auto">
  <name>Task 2: Add #[Computed] attributes to derived values</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add the Computed attribute import at the top of the file:
```php
use Livewire\Attributes\Computed;
```

Identify existing methods that compute derived values and add #[Computed]. Look for methods like:
- `getSceneCount()` or similar scene counting
- `getProgress()` or progress calculation
- `getTotalDuration()` or duration calculations
- Any getter that derives values from other properties

Also create new computed properties for common derivations:

1. **Scene counts:**
```php
#[Computed]
public function sceneCount(): int
{
    return count($this->script['scenes'] ?? []);
}
```

2. **Total shot count:**
```php
#[Computed]
public function totalShotCount(): int
{
    $total = 0;
    foreach ($this->multiShotMode['decomposedScenes'] ?? [] as $scene) {
        $total += count($scene['shots'] ?? []);
    }
    return $total;
}
```

3. **Character count:**
```php
#[Computed]
public function characterCount(): int
{
    return count($this->sceneMemory['characterBible']['characters'] ?? []);
}
```

4. **Location count:**
```php
#[Computed]
public function locationCount(): int
{
    return count($this->sceneMemory['locationBible']['locations'] ?? []);
}
```

5. **Has style bible:**
```php
#[Computed]
public function hasStyleBible(): bool
{
    return !empty($this->sceneMemory['styleBible']['enabled'])
        && !empty($this->sceneMemory['styleBible']['style']);
}
```

In Blade templates, these are accessed as properties (not methods):
- `$this->sceneCount` (not `$this->sceneCount()`)

NOTE: #[Computed] in Livewire 3 caches the value for the duration of the request. It's recalculated on the next request automatically.
  </action>
  <verify>
Check that computed properties work in Blade context by verifying the syntax:
```bash
grep -n "#\[Computed\]" modules/AppVideoWizard/app/Livewire/VideoWizard.php
```
Should show at least 5 computed property methods.
  </verify>
  <done>At least 5 computed properties exist with #[Computed] attribute. Derived values are cached per-request instead of recalculated on every access.</done>
</task>

</tasks>

<verification>
After both tasks:
1. Component loads without errors: Visit the Video Wizard page
2. Properties with #[Locked] are excluded from serialization (verify via Livewire DevTools or network tab - payload should not contain locked properties)
3. Computed properties work in templates (no errors on page load)
4. All existing functionality works (navigate through wizard steps)
</verification>

<success_criteria>
1. VideoWizard.php contains `use Livewire\Attributes\Locked;` and `use Livewire\Attributes\Computed;`
2. At least 6 properties have #[Locked] attribute
3. At least 5 methods have #[Computed] attribute
4. Component loads without errors
5. Wizard navigation works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/19-quick-wins/19-01-SUMMARY.md`
</output>
